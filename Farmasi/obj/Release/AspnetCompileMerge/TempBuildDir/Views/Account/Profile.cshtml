@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    UserViewModel contragent = GeneralRepository.GetCurrentContragent();
    ContragentRelationViewModel cr = ViewBag.contRelation as ContragentRelationViewModel;
}

@model ChangePasswordViewModel

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>@string.Format("{0} - {1}", Farmasi.Resources.Translator.Farmasi, Farmasi.Resources.Translator.Profile)</title>

    <link href="~/Content/profile.css" rel="stylesheet" />
    <link href="~/Content/bootstrap.vertical-tabs.min.css" rel="stylesheet" />

    <script src="~/Scripts/farmasi/controllers/profile-controller.js"></script>    
</head>
<body>
    <div class="container" style="padding: 0; height: 100%;" ng-controller="profile-ctrl">
        <div class="col-md-2" style="padding: 0;">
            <!-- required for floating -->
            <!-- Nav tabs -->
            <ul class="nav nav-tabs tabs-left">
                <!-- 'tabs-right' for right tabs -->
                <li class="active"><a href="#home" data-toggle="tab"><i class="fa fa-id-card-o"></i> @Farmasi.Resources.Translator.Primary</a></li>
                <li><a href="#profile" data-toggle="tab"><i class="fa fa-sitemap"></i> @Farmasi.Resources.Translator.Structure</a></li>
            </ul>
        </div>
        <div class="col-md-10" style="height: 100%;">
            <!-- Tab panes -->
            <div class="tab-content" style="height: 100%;">
                <div class="tab-pane active" id="home">
                    <div class="row">
                        <div class="col-xs-11 col-sm-11 col-md-11 col-lg-11" style="padding: 0 0 0 10px;">
                            <div class="panel panel-info">
                                <div class="panel-heading">
                                    <h3 class="panel-title">@contragent.Name</h3>
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-3 col-lg-3" align="center"> <img src="~/Content/Resources/profile-image.png" class="img-circle img-responsive"></div>

                                        <div class="col-md-9 col-lg-9">
                                            <table class="table table-user-information">
                                                <tbody>
                                                    <tr>
                                                        <td>@Farmasi.Resources.Translator.UsrName:</td>
                                                        <td>@contragent.UserName</td>
                                                    </tr>
                                                    <tr>
                                                        <td>@Farmasi.Resources.Translator.Phone:</td>
                                                        <td>@contragent.Tel</td>
                                                    </tr>
                                                    <tr>
                                                        <td>@Farmasi.Resources.Translator.Email:</td>
                                                        <td><a href="mailto:@contragent.Email">@contragent.Email</a></td>
                                                    </tr>
                                                    <tr>
                                                        <td>@Farmasi.Resources.Translator.Address:</td>
                                                        <td>@contragent.Address</td>
                                                    </tr>
                                                    <tr>
                                                        <td>@Farmasi.Resources.Translator.Debt:</td>
                                                        <td>@StructureRepository.GetCurrentContragentRelationAmount()</td>
                                                    </tr>
                                                    <tr>
                                                        <td>@Farmasi.Resources.Translator.Link:</td>
                                                        <td><span id="rf_link" onclick="selectRfLink()">@contragent.RfLink</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                        <td style="padding-right: 0;">
                                                            <a style="cursor: pointer;" data-toggle="collapse" data-target="#cp">@Farmasi.Resources.Translator.ChangePassword</a>
                                                            @if (ViewBag.Error != null)
                                                            {
                                                                <div class="alert small alert-danger" style="margin-top: 5px; width: 50%;">
                                                                    @ViewBag.Error
                                                                </div>
                                                            }
                                                            <div class="form collapse" id="cp">
                                                                @using (Html.BeginForm("profile", "account", FormMethod.Post))
                                                                {
                                                                    @Html.AntiForgeryToken()
                                                                    <section style="margin-top: 5px; width: 50%;">                                                                       
                                                                        <div class="form-group" style="margin-bottom: 7px;">
                                                                            @Html.PasswordFor(m => m.CurrentPassword, new { id = "currentPassword", placeholder = Farmasi.Resources.Translator.CurrentPassword, autofocus = true })
                                                                        </div>
                                                                        
                                                                        <div class="form-group" style="margin-bottom: 7px;">
                                                                            @Html.PasswordFor(m => m.NewPassword, new { id = "newPassword", placeholder = Farmasi.Resources.Translator.NewPassword })
                                                                        </div>

                                                                        <div class="form-group">
                                                                            @Html.PasswordFor(m => m.RepeatPassword, new { id = "repeatPassword", placeholder = Farmasi.Resources.Translator.RepeatPassword })
                                                                        </div>

                                                                        <button type="submit"><i class="fa fa-refresh"></i> @Farmasi.Resources.Translator.Change</button>
                                                                    </section>
                                                                }
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-12" style="padding: 0;">
                                        <form class="form-inline" style="margin-bottom: 10px; float: left;">
                                            <div class="input-group">
                                                <input ng-click="openFromDatepicker1($event)" readonly style="width: 100px;" type="text" class="form-control input-sm" datepicker-options="dateOptions1" datepicker-popup="dd.MM.yyyy" ng-model="date_from1" is-open="from_opened1" on-open-focus="false" close-text="დახურვა" clear-text="გასუფთავება" current-text="დღეს">
                                                <div class="input-group-btn" dropdown>
                                                    <button type="button" id="single-button" style="margin: 0 4px 0 4px;" class="btn btn-sm btn-default" dropdown-toggle tabindex="-1">
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                    <ul class="dropdown-menu choices" role="menu" aria-labelledby="single-button" style="cursor: pointer;">
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('today')">დღეს</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('year')">მიმდინარე წელიწადი</a></li>
                                                        <li role="menuitem" class="divider"></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('kvartali1')">I კვარტალი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('kvartali2')">II კვარტალი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('kvartali3')">III კვარტალი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('kvartali4')">IV კვარტალი</a></li>
                                                        <li role="menuitem" class="divider"></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('yan')">01 - იანვარი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('feb')">02 - თებერვალი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('mar')">03 - მარტი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('apr')">04 - აპრილი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('may')">05 - მაისი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('jun')">06 - ივნისი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('jul')">07 - ივლისი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('aug')">08 - აგვისტო</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('sep')">09 - სექტემბერი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('oct')">10 - ოქტომბერი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('nov')">11 - ნოემბერი</a></li>
                                                        <li role="menuitem"><a ng-click="menuChoiceClick1('dec')">12 - დეკემბერი</a></li>
                                                    </ul>
                                                </div>
                                                <input ng-click="openToDatepicker1($event)" readonly style="width: 100px;" type="text" class="form-control input-sm" datepicker-options="dateOptions1" datepicker-popup="dd.MM.yyyy" ng-model="date_to1" is-open="to_opened1" on-open-focus="false" close-text="დახურვა" clear-text="გასუფთავება" current-text="დღეს">
                                            </div>

                                            <a class="btn btn-sm btn-default" ng-click="refresh1()"><i class="fa fa-refresh"></i> @Farmasi.Resources.Translator.Refresh</a>                                            
                                        </form>

                                        <table class="table table-bordered table-striped">
                                            <thead>
                                                <tr>
                                                    <td>@Farmasi.Resources.Translator.PrivateSales</td>
                                                    <td>@Farmasi.Resources.Translator.GroupBonusWithVat</td>
                                                    <td>@Farmasi.Resources.Translator.GroupBonusWithoutVat</td>
                                                    <td>@Farmasi.Resources.Translator.PrivateBonus</td>
                                                    <td>@Farmasi.Resources.Translator.GroupBonus</td>
                                                    @*<td>@Farmasi.Resources.Translator.Percent</td>*@
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>{{contRelation.sales}}</td>
                                                    <td>{{contRelation.groupSales}}</td>
                                                    <td>{{contRelation.groupBonusWithoutVat}}</td>
                                                    <td>{{contRelation.bonus}}</td>
                                                    <td>{{contRelation.groupPayBonus}}</td>
                                                    @*<td>{{contRelation.percent}}%</td>*@
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane row" id="profile" style="height: 100%; width: 100%;">
                    <div class="col-md-4" style="height: 100%; padding: 0 10px 0 10px;">
                        @helper ShowTree(List<RelationTreeNodeViewModel> contragents)
                        {
                            <ul>
                                @foreach (RelationTreeNodeViewModel contragent in contragents)
                                {
                                    <li>
                                        <a href="javascript: getContragentInfoById(@contragent.Cid)">
                                            <i class="fa fa-user" style="color: orange;"></i> @contragent.Text
                                        </a>
                                        @if (contragent.Nodes.Any())
                                        {
                                            @ShowTree(contragent.Nodes)
                                        }
                                    </li>
                                }
                            </ul>
                        }                        

                        <a ng-click="generate()" class="btn btn-default" style="width: 100%; margin-bottom: 5px;"><i ng-if="!showLoader" class="fa fa-refresh"></i> <img ng-if="showLoader" src="~/Content/Resources/loader.gif" /> @Farmasi.Resources.Translator.Generate</a>
                        <div class="tree">
                            @ShowTree(ViewBag.contragents)
                        </div>   
                        
                        <script type="text/javascript">
                            $(document).ready(function () {
                                $('.tree li').each(function () {
                                    if ($(this).children('ul').length > 0) {
                                        $(this).addClass('parent');
                                    }
                                });

                                $('.tree li.parent > a').click(function () {
                                    $(this).parent().toggleClass('active');
                                    $(this).parent().children('ul').slideToggle('fast');
                                });

                                $('#all').click(function () {
                                    $('.tree li').each(function () {
                                        $(this).toggleClass('active');
                                        $(this).children('ul').slideToggle('fast');
                                    });
                                });
                            });
                        </script>                     
                    </div>

                    <div class="col-md-8" style="padding: 0;">  
                        <ul class="nav nav-tabs">
                            <!-- 'tabs-right' for right tabs -->
                            <li class="active"><a href="#sales" data-toggle="tab"><i class="fa fa-book"></i> @Farmasi.Resources.Translator.Sales</a></li>
                            <li><a href="#staff" data-toggle="tab"><i class="fa fa-users"></i> @Farmasi.Resources.Translator.Staff</a></li>
                        </ul>                     
                        <div class="tab-content">
                            <div class="tab-pane active" id="sales">
                                <form class="form-inline" style="margin-bottom: 10px; float: left; margin-top: 15px;">
                                    <div class="input-group">
                                        <input ng-click="openFromDatepicker($event)" readonly style="width: 100px;" type="text" class="form-control input-sm" datepicker-options="dateOptions" datepicker-popup="dd.MM.yyyy" ng-model="date_from" is-open="from_opened" on-open-focus="false" close-text="დახურვა" clear-text="გასუფთავება" current-text="დღეს">
                                        <div class="input-group-btn" dropdown>
                                            <button type="button" id="single-button" style="margin: 0 4px 0 4px;" class="btn btn-sm btn-default" dropdown-toggle tabindex="-1">
                                                <i class="fa fa-calendar"></i>
                                            </button>
                                            <ul class="dropdown-menu choices" role="menu" aria-labelledby="single-button" style="cursor: pointer;">
                                                <li role="menuitem"><a ng-click="menuChoiceClick('today')">დღეს</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('year')">მიმდინარე წელიწადი</a></li>
                                                <li role="menuitem" class="divider"></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('kvartali1')">I კვარტალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('kvartali2')">II კვარტალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('kvartali3')">III კვარტალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('kvartali4')">IV კვარტალი</a></li>
                                                <li role="menuitem" class="divider"></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('yan')">01 - იანვარი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('feb')">02 - თებერვალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('mar')">03 - მარტი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('apr')">04 - აპრილი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('may')">05 - მაისი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('jun')">06 - ივნისი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('jul')">07 - ივლისი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('aug')">08 - აგვისტო</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('sep')">09 - სექტემბერი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('oct')">10 - ოქტომბერი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('nov')">11 - ნოემბერი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick('dec')">12 - დეკემბერი</a></li>
                                            </ul>
                                        </div>
                                        <input ng-click="openToDatepicker($event)" readonly style="width: 100px;" type="text" class="form-control input-sm" datepicker-options="dateOptions" datepicker-popup="dd.MM.yyyy" ng-model="date_to" is-open="to_opened" on-open-focus="false" close-text="დახურვა" clear-text="გასუფთავება" current-text="დღეს">
                                    </div>

                                    <a class="btn btn-sm btn-default" ng-click="refresh()"><i class="fa fa-refresh"></i> @Farmasi.Resources.Translator.Refresh</a>

                                    <input class="form-control input-sm" placeholder=@Farmasi.Resources.Translator.Search style="margin-left: 25px;" ng-model="searchProductOut" />
                                </form>

                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <td>@Farmasi.Resources.Translator.Date</td>
                                            <td>@Farmasi.Resources.Translator.Number</td>
                                            <td>@Farmasi.Resources.Translator.Purpose</td>
                                            <td>@Farmasi.Resources.Translator.Amount</td>
                                            <td>@Farmasi.Resources.Translator.Currency</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="po in productOuts | filter: searchProductOut">
                                            <td>{{po.tdate}}</td>
                                            <td>{{po.num}}</td>
                                            <td>{{po.purpose}}</td>
                                            <td>{{po.amount}}</td>
                                            <td>{{po.currency}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane" id="staff">
                                <form class="form-inline" style="margin-bottom: 10px; float: left; margin-top: 15px;">
                                    <div class="input-group">
                                        <input ng-click="openFromDatepicker2($event)" readonly style="width: 100px;" type="text" class="form-control input-sm" datepicker-options="dateOptions2" datepicker-popup="dd.MM.yyyy" ng-model="date_from2" is-open="from_opened2" on-open-focus="false" close-text="დახურვა" clear-text="გასუფთავება" current-text="დღეს">
                                        <div class="input-group-btn" dropdown>
                                            <button type="button" id="single-button" style="margin: 0 4px 0 4px;" class="btn btn-sm btn-default" dropdown-toggle tabindex="-1">
                                                <i class="fa fa-calendar"></i>
                                            </button>
                                            <ul class="dropdown-menu choices" role="menu" aria-labelledby="single-button" style="cursor: pointer;">
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('today')">დღეს</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('year')">მიმდინარე წელიწადი</a></li>
                                                <li role="menuitem" class="divider"></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('kvartali1')">I კვარტალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('kvartali2')">II კვარტალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('kvartali3')">III კვარტალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('kvartali4')">IV კვარტალი</a></li>
                                                <li role="menuitem" class="divider"></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('yan')">01 - იანვარი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('feb')">02 - თებერვალი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('mar')">03 - მარტი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('apr')">04 - აპრილი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('may')">05 - მაისი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('jun')">06 - ივნისი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('jul')">07 - ივლისი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('aug')">08 - აგვისტო</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('sep')">09 - სექტემბერი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('oct')">10 - ოქტომბერი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('nov')">11 - ნოემბერი</a></li>
                                                <li role="menuitem"><a ng-click="menuChoiceClick2('dec')">12 - დეკემბერი</a></li>
                                            </ul>
                                        </div>
                                        <input ng-click="openToDatepicker2($event)" readonly style="width: 100px;" type="text" class="form-control input-sm" datepicker-options="dateOptions2" datepicker-popup="dd.MM.yyyy" ng-model="date_to2" is-open="to_opened2" on-open-focus="false" close-text="დახურვა" clear-text="გასუფთავება" current-text="დღეს">
                                    </div>

                                    <a class="btn btn-sm btn-default" ng-click="refresh2()"><i class="fa fa-refresh"></i> @Farmasi.Resources.Translator.Refresh</a>

                                    <input class="form-control input-sm" placeholder=@Farmasi.Resources.Translator.Search style="margin-left: 25px;" ng-model="searchRegisteredStaff" />
                                </form>

                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <td>@Farmasi.Resources.Translator.Date</td>
                                            <td>@Farmasi.Resources.Translator.PN</td>
                                            <td>@Farmasi.Resources.Translator.FullName</td>
                                            <td>@Farmasi.Resources.Translator.Phone</td>
                                            <td>@Farmasi.Resources.Translator.Email</td>
                                            <td>@Farmasi.Resources.Translator.Address</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="rs in registeredStaff | filter: searchRegisteredStaff">
                                            <td>{{rs.createDate}}</td>
                                            <td>{{rs.code}}</td>
                                            <td>{{rs.name}}</td>
                                            <td>{{rs.tel}}</td>
                                            <td>{{rs.email}}</td>
                                            <td>{{rs.address}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>                       
                    </div>                    
                </div>
            </div>
        </div>      
    </div>
</body>
</html>